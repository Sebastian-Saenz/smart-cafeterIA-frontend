<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Callback Google OAuth</title>
</head>

<body>
    <script src="{{ url_for('static', filename='js/oauthSignIn.js') }}?v=2"></script>
    <script>
        (function () {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');
            const state = params.get('state');
            const stateOut = localStorage.getItem('oauth_state');

            console.log({ code, state, stateOut });

            if (code && state === stateOut) {
                localStorage.removeItem('oauth_state');

                fetch('/auth/google', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                })
                    .then(res => res.json())
                    .then(data => {
                        console.log('Tokens recibidos:', data);
                        window.location = '/';
                    });
            } else {
                console.error('Codigo o state invlido');
            }
        })();
    </script>
</body>

</html>